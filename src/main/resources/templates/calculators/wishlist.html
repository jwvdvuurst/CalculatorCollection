<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/x-icon" href="/favicon.ico">
	<link rel="icon" type="image/png" href="/favicon.png">
	<title>My Wishlist - Calculator Collector</title>
	<style>
		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			margin: 0;
			padding: 0;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
		}
		.navbar {
			background: white;
			padding: 15px 30px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.navbar a {
			color: #667eea;
			text-decoration: none;
			margin: 0 15px;
			font-weight: 500;
		}
		.navbar a:hover {
			color: #5568d3;
		}
		.container {
			max-width: 1200px;
			margin: 30px auto;
			padding: 0 20px;
		}
		.header-section {
			background: white;
			border-radius: 10px;
			padding: 30px;
			margin-bottom: 20px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		}
		.calculator-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}
		.calculator-card {
			background: white;
			border-radius: 10px;
			padding: 20px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			transition: transform 0.2s, box-shadow 0.2s;
		}
		.calculator-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
		}
		.calculator-card h3 {
			margin: 0 0 10px 0;
			color: #333;
		}
		.calculator-card .manufacturer {
			color: #667eea;
			font-weight: 500;
			margin-bottom: 10px;
		}
		.calculator-card .details {
			color: #666;
			font-size: 0.9em;
			margin: 5px 0;
		}
		.calculator-card .added-date {
			color: #999;
			font-size: 0.8em;
			margin-top: 10px;
		}
		.calculator-card .actions {
			margin-top: 15px;
		}
		.btn {
			padding: 8px 16px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 0.9em;
			text-decoration: none;
			display: inline-block;
		}
		.btn-primary {
			background: #667eea;
			color: white;
		}
		.btn-primary:hover {
			background: #5568d3;
		}
		.btn-success {
			background: #28a745;
			color: white;
		}
		.btn-success:hover {
			background: #218838;
		}
		.btn-danger {
			background: #e74c3c;
			color: white;
		}
		.btn-danger:hover {
			background: #c0392b;
		}
		.pagination {
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 10px;
			margin-top: 30px;
		}
		.pagination a, .pagination span {
			padding: 10px 15px;
			background: white;
			border-radius: 5px;
			text-decoration: none;
			color: #667eea;
			font-weight: 500;
		}
		.pagination span {
			background: #667eea;
			color: white;
		}
		.alert {
			padding: 15px;
			border-radius: 5px;
			margin-bottom: 20px;
		}
		.alert-success {
			background: #d4edda;
			color: #155724;
			border: 1px solid #c3e6cb;
		}
		.alert-error {
			background: #f8d7da;
			color: #721c24;
			border: 1px solid #f5c6cb;
		}
		.empty-state {
			background: white;
			border-radius: 10px;
			padding: 40px;
			text-align: center;
			color: #666;
		}
		.hidden {
			display: none;
		}
	</style>
</head>
<body>
	<div class="navbar">
		<div>
			<a href="/welcome">Home</a>
			<a href="/calculators">Browse Calculators</a>
			<a href="/calculators/manufacturers">Manufacturers</a>
			<sec:authorize="isAuthenticated()">
				<a href="/calculators/collection">My Collection</a>
				<a href="/calculators/wishlist">My Wishlist</a>
			</sec:authorize>
		</div>
		<div>
			<sec:authorize="isAuthenticated()">
				<a href="/profile">My Profile</a>
				<span style="margin-left: 15px;">Hello, <strong sec:authentication="name"></strong>!</span>
				<a href="/logout" style="margin-left: 15px;">Logout</a>
			</sec:authorize>
			<sec:authorize="!isAuthenticated()">
				<a href="/login">Login</a>
			</sec:authorize>
		</div>
	</div>

	<div class="container">
		<div class="header-section">
			<h2>My Calculator Wishlist</h2>
			<p th:text="'Total calculators in wishlist: ' + ${wishlistCount}">Total: 0</p>
		</div>

		<div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
		<div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

		<div th:if="${wishlist != null && !wishlist.isEmpty()}">
			<div class="calculator-grid">
				<div th:each="item : ${wishlist.content}" class="calculator-card">
					<h3 th:text="${item.calculator.model}">Model</h3>
					<div class="manufacturer" th:text="${item.calculator.manufacturer.name}">Manufacturer</div>
					<div class="details" th:if="${item.calculator.soldFrom != null}">
						<strong>Years:</strong> <span th:text="${item.calculator.soldFrom}"></span>
						<span th:if="${item.calculator.soldTo != null}" th:text="' - ' + ${item.calculator.soldTo}"></span>
					</div>
					<div class="added-date" th:text="'Added: ' + ${#temporals.format(item.addedAt, 'yyyy-MM-dd HH:mm')}">Added date</div>
					
					<!-- Notes Section -->
					<div class="notes-section" style="margin: 15px 0;">
						<div class="notes-display" th:id="'notes-display-' + ${item.calculator.id}">
							<div th:if="${item.notes != null && !item.notes.isEmpty()}" 
								 style="background: #f5f5f5; padding: 10px; border-radius: 5px; margin-bottom: 5px; font-size: 0.9em; color: #555;">
								<strong>Notes:</strong>
								<div th:text="${item.notes}">Notes text</div>
							</div>
							<button type="button" class="btn" 
									style="background: #28a745; color: white; font-size: 0.8em; padding: 5px 10px;"
									th:onclick="'editNotes(' + ${item.calculator.id} + ')'">
								<span th:text="${item.notes != null && !item.notes.isEmpty()} ? 'Edit Notes' : 'Add Notes'">Add Notes</span>
							</button>
						</div>
						<div class="notes-edit hidden" th:id="'notes-edit-' + ${item.calculator.id}">
							<form th:action="@{/calculators/wishlist/{id}/notes(id=${item.calculator.id})}" method="post">
								<textarea name="notes" 
										  style="width: 100%; min-height: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; font-size: 0.9em;"
										  th:text="${item.notes}">Notes</textarea>
								<div style="margin-top: 5px; display: flex; gap: 5px;">
									<button type="submit" class="btn" style="background: #667eea; color: white; font-size: 0.8em; padding: 5px 10px;">Save</button>
									<button type="button" class="btn" style="background: #6c757d; color: white; font-size: 0.8em; padding: 5px 10px;"
											th:onclick="'cancelEditNotes(' + ${item.calculator.id} + ')'">Cancel</button>
								</div>
							</form>
						</div>
					</div>
					
					<!-- Search Queries Section -->
					<div class="search-queries-section" style="margin: 15px 0; border-top: 1px solid #eee; padding-top: 15px;">
						<div class="search-queries-display" th:id="'search-queries-display-' + ${item.calculator.id}">
							<strong style="font-size: 0.9em; color: #333; display: block; margin-bottom: 8px;">Search on Trading Sites:</strong>
							<div style="display: flex; flex-direction: column; gap: 5px; font-size: 0.85em;">
								<div th:if="${item.marktplaatsQuery != null && !item.marktplaatsQuery.isEmpty()}">
									<a th:attr="data-query=${item.marktplaatsQuery}" 
									   class="marktplaats-link"
									   target="_blank" 
									   style="color: #667eea; text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
										<span>üîç</span> <strong>Marktplaats:</strong> <span th:text="${item.marktplaatsQuery}"></span>
									</a>
								</div>
								<div th:if="${item.ebayQuery != null && !item.ebayQuery.isEmpty()}">
									<a th:attr="data-query=${item.ebayQuery}" 
									   class="ebay-link"
									   target="_blank" 
									   style="color: #667eea; text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
										<span>üîç</span> <strong>eBay:</strong> <span th:text="${item.ebayQuery}"></span>
									</a>
								</div>
								<div th:if="${item.etsyQuery != null && !item.etsyQuery.isEmpty()}">
									<a th:attr="data-query=${item.etsyQuery}" 
									   class="etsy-link"
									   target="_blank" 
									   style="color: #667eea; text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
										<span>üîç</span> <strong>Etsy:</strong> <span th:text="${item.etsyQuery}"></span>
									</a>
								</div>
								<div th:if="${(item.marktplaatsQuery == null || item.marktplaatsQuery.isEmpty()) && 
											  (item.ebayQuery == null || item.ebayQuery.isEmpty()) && 
											  (item.etsyQuery == null || item.etsyQuery.isEmpty())}"
									 style="color: #999; font-style: italic;">
									No search queries configured
								</div>
							</div>
							<div style="display: flex; gap: 5px; margin-top: 8px;">
								<button type="button" class="btn" 
										style="background: #17a2b8; color: white; font-size: 0.8em; padding: 5px 10px;"
										th:onclick="'editSearchQueries(' + ${item.calculator.id} + ')'">
									Edit Search Queries
								</button>
								<form th:action="@{/calculators/wishlist/{id}/search-queries/reset(id=${item.calculator.id})}" 
									  method="post" 
									  style="display: inline;"
									  onsubmit="return confirm('Reset search queries to default format? This will overwrite your current queries.')">
									<button type="submit" class="btn" 
											style="background: #6c757d; color: white; font-size: 0.8em; padding: 5px 10px;">
										Reset to Default
									</button>
								</form>
							</div>
						</div>
						<div class="search-queries-edit hidden" th:id="'search-queries-edit-' + ${item.calculator.id}">
							<form th:action="@{/calculators/wishlist/{id}/search-queries(id=${item.calculator.id})}" method="post">
								<div style="margin-bottom: 10px;">
									<label style="display: block; font-size: 0.85em; font-weight: 500; margin-bottom: 3px; color: #333;">Marktplaats.nl:</label>
									<input type="text" name="marktplaatsQuery" 
										   style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.85em;"
										   th:value="${item.marktplaatsQuery}"
										   placeholder="e.g., HP 12C calculator">
								</div>
								<div style="margin-bottom: 10px;">
									<label style="display: block; font-size: 0.85em; font-weight: 500; margin-bottom: 3px; color: #333;">eBay:</label>
									<input type="text" name="ebayQuery" 
										   style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.85em;"
										   th:value="${item.ebayQuery}"
										   placeholder="e.g., HP 12C calculator">
								</div>
								<div style="margin-bottom: 10px;">
									<label style="display: block; font-size: 0.85em; font-weight: 500; margin-bottom: 3px; color: #333;">Etsy:</label>
									<input type="text" name="etsyQuery" 
										   style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.85em;"
										   th:value="${item.etsyQuery}"
										   placeholder="e.g., HP 12C calculator">
								</div>
								<div style="margin-top: 8px; display: flex; gap: 5px;">
									<button type="submit" class="btn" style="background: #667eea; color: white; font-size: 0.8em; padding: 5px 10px;">Save</button>
									<button type="button" class="btn" style="background: #6c757d; color: white; font-size: 0.8em; padding: 5px 10px;"
											th:onclick="'cancelEditSearchQueries(' + ${item.calculator.id} + ')'">Cancel</button>
								</div>
							</form>
						</div>
					</div>
					
					<div class="actions">
						<a th:href="@{/calculators/{id}(id=${item.calculator.id})}" class="btn btn-primary" style="margin-bottom: 10px; display: block; text-align: center;">View Details</a>
						<form th:action="@{/calculators/wishlist/{id}/move-to-collection(id=${item.calculator.id})}" method="post" style="margin-bottom: 10px;">
							<button type="submit" class="btn btn-success" style="width: 100%;">Move to Collection</button>
						</form>
						<form th:action="@{/calculators/wishlist/remove/{id}(id=${item.calculator.id}, redirectTo='wishlist')}" method="post">
							<button type="submit" class="btn btn-danger" style="width: 100%;">Remove from Wishlist</button>
						</form>
					</div>
				</div>
			</div>

			<div class="pagination" th:if="${wishlist.totalPages > 1}">
				<a th:if="${wishlist.hasPrevious()}" 
				   th:href="@{/calculators/wishlist(page=${wishlist.number - 1})}">Previous</a>
				<span th:text="'Page ' + (${wishlist.number} + 1) + ' of ' + ${wishlist.totalPages}"></span>
				<a th:if="${wishlist.hasNext()}" 
				   th:href="@{/calculators/wishlist(page=${wishlist.number + 1})}">Next</a>
			</div>
		</div>

		<div th:if="${wishlist == null || wishlist.isEmpty()}" class="empty-state">
			<h3>Your wishlist is empty</h3>
			<p>Start building your wishlist by browsing calculators and adding them to your wishlist!</p>
			<a href="/calculators" class="btn" style="margin-top: 20px; background: #667eea; color: white;">Browse Calculators</a>
		</div>
	</div>

	<script>
		// Set up search query links with proper URL encoding
		document.addEventListener('DOMContentLoaded', function() {
			// Marktplaats links
			document.querySelectorAll('a.marktplaats-link').forEach(function(link) {
				const query = link.getAttribute('data-query');
				if (query) {
					const encoded = encodeURIComponent(query);
					link.href = 'https://www.marktplaats.nl/q/' + encoded + '/';
				}
			});
			
			// eBay links
			document.querySelectorAll('a.ebay-link').forEach(function(link) {
				const query = link.getAttribute('data-query');
				if (query) {
					const encoded = encodeURIComponent(query);
					link.href = 'https://www.ebay.nl/sch/i.html?_nkw=' + encoded;
				}
			});
			
			// Etsy links
			document.querySelectorAll('a.etsy-link').forEach(function(link) {
				const query = link.getAttribute('data-query');
				if (query) {
					const encoded = encodeURIComponent(query);
					link.href = 'https://www.etsy.com/nl/search?q=' + encoded;
				}
			});
		});
		
		function editNotes(calculatorId) {
			const display = document.getElementById('notes-display-' + calculatorId);
			const edit = document.getElementById('notes-edit-' + calculatorId);
			display.classList.add('hidden');
			edit.classList.remove('hidden');
		}
		
		function cancelEditNotes(calculatorId) {
			const display = document.getElementById('notes-display-' + calculatorId);
			const edit = document.getElementById('notes-edit-' + calculatorId);
			display.classList.remove('hidden');
			edit.classList.add('hidden');
		}
		
		function editSearchQueries(calculatorId) {
			const display = document.getElementById('search-queries-display-' + calculatorId);
			const edit = document.getElementById('search-queries-edit-' + calculatorId);
			display.classList.add('hidden');
			edit.classList.remove('hidden');
		}
		
		function cancelEditSearchQueries(calculatorId) {
			const display = document.getElementById('search-queries-display-' + calculatorId);
			const edit = document.getElementById('search-queries-edit-' + calculatorId);
			display.classList.remove('hidden');
			edit.classList.add('hidden');
		}
	</script>
</body>
</html>






